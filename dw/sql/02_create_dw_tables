-- Table: dw.dim_cliente

-- DROP TABLE IF EXISTS dw.dim_cliente;

CREATE TABLE IF NOT EXISTS dw.dim_cliente
(
    clave_cliente integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    cliente_id integer NOT NULL,
    email_cliente character varying(150) COLLATE pg_catalog."default",
    nombre character varying(100) COLLATE pg_catalog."default",
    apellido character varying(100) COLLATE pg_catalog."default",
    ciudad character varying(100) COLLATE pg_catalog."default",
    fecha_inicio_vigencia date NOT NULL,
    fecha_fin_vigencia date,
    es_actual boolean NOT NULL,
    CONSTRAINT dim_cliente_pkey PRIMARY KEY (clave_cliente),
    CONSTRAINT uq_cliente_version UNIQUE (cliente_id, fecha_inicio_vigencia)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS dw.dim_cliente
    OWNER to postgres;
---------------------------------------------------------------------------------------------------

-- Table: dw.dim_fecha

-- DROP TABLE IF EXISTS dw.dim_fecha;

CREATE TABLE IF NOT EXISTS dw.dim_fecha
(
    clave_fecha integer NOT NULL DEFAULT nextval('dw.dim_fecha_clave_fecha_seq'::regclass),
    fecha_completa date NOT NULL,
    anio integer NOT NULL,
    trimestre integer NOT NULL,
    mes integer NOT NULL,
    nombre_mes character varying(20) COLLATE pg_catalog."default" NOT NULL,
    dia integer NOT NULL,
    nombre_dia_semana character varying(20) COLLATE pg_catalog."default" NOT NULL,
    es_fin_de_semana boolean NOT NULL,
    CONSTRAINT dim_fecha_pkey PRIMARY KEY (clave_fecha)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS dw.dim_fecha
    OWNER to postgres;
--------------------------------------------------------------------------------------------------------------

-- Table: dw.dim_producto

-- DROP TABLE IF EXISTS dw.dim_producto;

CREATE TABLE IF NOT EXISTS dw.dim_producto
(
    clave_producto integer NOT NULL DEFAULT nextval('dw.dim_producto_clave_producto_seq'::regclass),
    producto_id integer NOT NULL,
    nombre_producto character varying(100) COLLATE pg_catalog."default",
    categoria character varying(50) COLLATE pg_catalog."default",
    precio numeric(10,2),
    fecha_inicio_vigencia date NOT NULL,
    fecha_fin_vigencia date,
    es_actual boolean NOT NULL,
    CONSTRAINT dim_producto_pkey PRIMARY KEY (clave_producto),
    CONSTRAINT uq_producto_version UNIQUE (producto_id, fecha_inicio_vigencia)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS dw.dim_producto
    OWNER to postgres;
-------------------------------------------------------------------------------------------------------------
-- Table: dw.fact_ventas_detalle

-- DROP TABLE IF EXISTS dw.fact_ventas_detalle;

CREATE TABLE IF NOT EXISTS dw.fact_ventas_detalle
(
    id_venta_detalle integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    clave_producto integer NOT NULL,
    clave_cliente integer NOT NULL,
    clave_fecha integer NOT NULL,
    cantidad integer NOT NULL,
    precio_unitario numeric(10,2) NOT NULL,
    total_venta numeric(12,2) GENERATED ALWAYS AS (((cantidad)::numeric * precio_unitario)) STORED,
    CONSTRAINT fact_ventas_detalle_pkey PRIMARY KEY (id_venta_detalle),
    CONSTRAINT fk_cliente FOREIGN KEY (clave_cliente)
        REFERENCES dw.dim_cliente (clave_cliente) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
    CONSTRAINT fk_fecha FOREIGN KEY (clave_fecha)
        REFERENCES dw.dim_fecha (clave_fecha) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
    CONSTRAINT fk_producto FOREIGN KEY (clave_producto)
        REFERENCES dw.dim_producto (clave_producto) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS dw.fact_ventas_detalle
    OWNER to postgres;
